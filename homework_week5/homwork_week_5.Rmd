---
output:
  pdf_document: default
  html_document: default
---
## R code for POLI502 Lab
## Week 4: Individual Exercises
## Written by: Conor Craig


# 1. Exploring a data set -------------------------------------------------

# We have learned several functions to explore a data set, including

```{r}
world.data <- read.csv("~/School/Fall 2023/Poli 502/world.csv")
```

```{r}
dim(world.data)
head(world.data)
tail(world.data)
```

# There are some other functions we can use. For example, the names
# function tells us the names of all the variables included in a data frame
# object. 

```{r}
names(world.data)
```

# The colnames function gives us the same results as well. 

```{r}
colnames(world.data)
```

# We can also apply the summary function without specifying variable
# names. Then, R will provide the summary of ALL the variables in cluded
# in a data frame object. 

```{r}
summary(world.data)
```

# The str() function tells us the structure of a data frame object, 
# meaning that it tells us which variables are factor, which ones are
# numerical, which ones are logical, etc.

```{r}
str(world.data)
```


# 2. Summarizing categorical variables ------------------------------------


# The output from the str function above tells us that there are many factor
# variables in the data set. For example, the democ_regime variable 
# is a factor variable (nominal-level). Summarize the information contained
# in this variable by creating a frequency table. 

```{r}
table(world.data$democ_regime)
```


# The typerel variable is another factor variable. 
# This variable measures predominant religion in a given country. 
# Create a frequency table for this variable. 

```{r}
table(world.data$typerel)
```

# Make this frequency table vertical using the data.frame function

```{r}
religion_table <- table(world.data$typerel)
vert_table <- data.frame(religion_table)
vert_table
```


# We have seen in the lecture that we often report RELATIVE frequencies
# as well as raw frequencies. Relative frequencies can be obtained by 
# dividing each of the raw frequency values by the total number of 
# observations. Let's see how we do this. 


# To do so, it is better if we create a new object that stores the 
# frequency table. Let's create an object called ft.colony that is
# equal to the vertical frequency table for the colony variable, 
# as follows. 

```{r}
ft.colony <- data.frame(table(world.data $ colony))
```

# To make sure we did this correctly, let's take a look

```{r}
ft.colony
```


# We can see that the first column, Var1, records all possible
# values and the second column, Freq, records the raw frequency. 


# To convert the raw frequencies into relative frequencies, we divide
# the values by the sum of Freq.
# As we learned before, we use the sum function to calculate the sum of
# all the values, as follows. 

```{r}
sum( ft.colony $ Freq )
```

# The relative frequencies are Freq divided by sum( ft.colony $ Freq )

```{r}
ft.colony $ Freq / sum( ft.colony $ Freq )
```

# Alternatively, we can use the prop.table function to obtain the 
# same results

```{r}
prop.table(ft.colony $ Freq)
```

# We would want to convert these further into percentages. 
# To make a ratio into a percentage, we simply multiply it by 100

```{r}
prop.table(ft.colony $ Freq) * 100
```


# We would want to round these numbers to simplify the representation. 
# As we leanred two weeks ago, we use the round function to do that. 

```{r}
round(prop.table(ft.colony $ Freq) * 100, digits = 2)
```


# Finally, we want to insert these numbers into the frequency table 
# we created and stored in ft.colony. 

```{r}
ft.colony
```

# How do we do it? 
# We do this by creating a new column in the ft.colony object. 
# As we learned last week, we use the $ symbol to create a new column
# in a data frame object, as follows

```{r}
ft.colony $ Percent <- round(prop.table(ft.colony $ Freq) * 100, digits = 2)
```

# Now, our frequency table contains three columns, as follows

```{r}
ft.colony
```

# Finally, we may want to change the column name for the first column
# from "Var1" to something more intuitive. 
# To do so, we use the colnames function, as follows

```{r}
colnames(ft.colony)[colnames(ft.colony) == "Var1"] <- "Colonizer"
ft.colony
```


# We can see that about 33% of the countries in the world are former colonies
# of the UK, about 15% of them are former colonies of France, about 10% of them
# were never colonized, etc. 


# To summarize the steps to create a frequency table:

```{r}
ft.colony <- data.frame( table(world.data $ colony) )
ft.colony $ Percent <- round(prop.table(ft.colony $ Freq) * 100, digits = 2)
colnames(ft.colony)[colnames(ft.colony) == "Var1"] <- "Colonizer"
ft.colony
```

# Create a frequency table for the typerel variable

```{r}
religion <- data.frame (table(world.data$typerel))
religion$Percent <- round(prop.table(religion$Freq) * 100, digits = 2)
colnames (religion)[colnames(religion) == "Var1"] <- "religion"
religion
```

# Which religion is the most "popular" in the world? 
# That is, what is the mode of the "typerel" variable?

```{r}
relig_data <- data.frame(world.data$typerel)
relig_freq_table <- table (relig_data$world.data.typerel)
mode_values <- names(relig_freq_table[relig_freq_table == max(relig_freq_table)])
cat("Mode of Religion:", paste(mode_values, collapse = ", "), "\n")
# Roman Catholic is the most popular religion within this sample
```

# What is the percentage of countries where muslim is the majority? 

```{r}
relig_data <- data.frame(world.data$typerel)
percent_relig_table <- prop.table (table(relig_data))
(percent_relig_table [c ("Muslim")]) *100
```

# Create a frequency table for democ_regime

```{r}
dem_data <- data.frame(world.data$democ_regime)
freq_dem_table <- table (dem_data)
View(freq_dem_table)
```

# What percentage of countries have a democratic regime?

```{r}
percent_demo_table <- prop.table (table(dem_data))
(percent_demo_table [c ("Yes")]) *100
```

# Create a bar chart to summarize the typerel variable

```{r}
library(ggplot2)
ggplot(world.data, aes(x = typerel)) + geom_bar()
```

# Create a bar chart to summarize the democ_regime variable

```{r}
ggplot(world.data, aes(x = democ_regime)) + geom_bar()
```

# 3. Making ggplot graphs look nicer --------------------------------------

# We have seen how to create a graph using the ggplot function

```{r}
ggplot(world.data, aes(x = colony)) + geom_bar()
```

# The command above is the easiest way to produce a simple ggplot
# graph, but we would want to modify some parts of the graph, such as
# axis labels. For example, the graph above currently says 
# "colony" on the x-axis and "count" on the y-axis. We may want to 
# modify them so they can be more informative. 


# When we want to modify graphs, we usually create a ggplot graph
# and store it into an object. Then we gradually add some features
# to modify them. The above command can be re-written as follows:


g <- ggplot(world.data)  # Tells R which data frame contains the variable to plot
g <- g + aes(x = colony) # Tells R which variable to plot
g <- g + geom_bar()      # Tells R what type of graph we want
g                        # Tells R to show the contents of the object g

# Now that we stored the graph into an object called g, we can 
# modify graph appearances by adding more options.

# To change the label for the x-axis, we use the xlab option, as follows

g <- g + xlab("Colony of Which Country?")
g

# Similarly, we can modify the label for the y-axis

g <- g + ylab("Number of countries")
g

# If you want to change the text size for axes, do

g <- g + theme(axis.text.x = element_text(size = 12))
g


# We can save this graph as a PDF file using the ggsave function. 

ggsave(file = "colony_bar.pdf", width = 10, height = 8)

# The file option specifies the file name of the PDF file
# you want to create. 
# The width and height option control the width and height of the
# PDF file, respectively. 
# Once you save a graph in a PDF, you can easily embed it in a 
# Word document simply by drag & drop.


# To summarize what we have done so far,

g <- ggplot(world.data)
g <- g + aes(x = colony)
g <- g + geom_bar()
g <- g + xlab("Colony of Which Country?")
g <- g + ylab("Number of countries")
g <- g + theme(axis.text.x = element_text(size = 12))
g
ggsave(file = "colony_bar.pdf", width = 10, height = 8)


# Create a bar chart for the typerel variable, and save it as a PDF file

```{r}
ggplot(world.data, aes (x = typerel)) + geom_bar()
ggsave(file = "religion_type_bar.pdf", width = 10, height = 8)
```

# 4. Summarizing numerical variables --------------------------------------

# There are two variables in the data set, gini04 and gini08, that measure 
# the levels of economic inequality in a country numerically. 
# These are what's called Gini coefficient (Gini index or Gini ratio), which
# takes values between 0 and 1 (or 0% and 100%). A value of 0 corresponds to
# the "perfect equality" case, where everyone in a country is earning the same 
# amount of money, whereas a value of 1 (100%) corresponds to the maximal 
# inequality case, where one person is earning ALL the money in a country and
# everyone else is earning nothing. The gini04 variable is from the year 2004
# whereas the gini08 variable is from the year 2008. 


# Numerically summarize the gini04 variable. 
# That is, calculate and present the measures for central tendency and 
# those for dispersion. 

```{r}
sum(is.na(world.data$gini04))
ginio4 <- na.omit(world.data$gini04)
mean(ginio4)
sd(ginio4)
```

# Numerically summarize the gini08 variable. 
# That is, calculate and present the measures for central tendency and 
# those for dispersion. 

```{r}
sum(is.na(world.data$gini08))
ginio8 <- na.omit(world.data$gini08)
mean(ginio8)
sd(ginio8)
```

# Compare the distributions of gini04 and gini08. Do you think that the 
# level of economic inequality is getting worse, getting better, or neither?
# Why or why not? 

# Note: I'm not asking why it is getting better, worse, or neither; 
#       I'm asking on what basis you can conclude that it's getting better or worse. 

```{r}
# Inequality has changed very little across the four years, though 2004 is
  # slightly better
```

# Create a histogram of gini04
# Modify the axis labels accordingly to make them informative and intuitive.
# Save the graph as a PDF file.

```{r}
hist(world.data$gini04, ylab = "Number of Countries", 
  xlab = "Within Country Inequality", main = "Comparing Country level Inequality")
  
ggplot (world.data, aes(gini04)) + geom_histogram() + 
labs (x = "Within Country Inequality", y = "Number of Countries", 
title = "Comparing Country level Inequality. 2004")

ggsave(file = "religion_type_bar.pdf", width = 10, height = 8)
```

# Create a histogram of gini08
# Modify the axis labels accordingly to make them informative and intuitive.
# Save the graph as a PDF file.

```{r}
ggplot (world.data, aes(gini04)) + geom_histogram() + 
labs (x = "Within Country Inequality", y = "Number of Countries", 
title = "Comparing Country level Inequality. 2008")

ggsave(file = "religion_type_bar.pdf", width = 10, height = 8)
```


# Compare the distributions of gini04 and gini08 graphically by 
# placing the two PDF files you just created side by side. 
# Do you confirm the conclusion you derived previously? 


```{r}
library(gridExtra)
gini_04_hist <- ggplot (world.data, aes(gini04)) + geom_histogram() + 
labs (x = "Within Country Inequality", y = "Number of Countries", 
title = "Comparing Country level Inequality. 2004")

gini_08_hist <- ggplot (world.data, aes(gini04)) + geom_histogram() + 
labs (x = "Within Country Inequality", y = "Number of Countries", 
title = "Comparing Country level Inequality. 2008")

grid.arrange(gini_04_hist, gini_08_hist, ncol = 2)

# Yes. The graphs are very similar.
```


# As we saw in the lecture, we sometimes create histograms for different
# values of a nominal-level variable. For example, we may want to create
# separate histograms of gini04 for countries in different regions.


# To do so, we use the facet_wrap option, as follows.


COPY & PASTE THE CODE YOU WROTE TO PRODUCE HISTOGRAM FOR gini04 HERE

g <- g + facet_wrap( ~ region)
g


# We can see that Scandinavian countries and Western European countries
# have, on average, lower Gini coefficients (= they are more egalitarian),
# whereas countries in South America have relatively high values. 




# Create separate histograms of women09 for countries in different regions.

```{r}
ggplot (world.data, aes(women09)) + geom_histogram() + facet_wrap( ~ region)
# Unsure what this variable is measuring which is why I did not include labels
```

# We may want to do the same using numerical methods.
# That is, we may want to obtain central tendencies and dispersions for
# a numerical variable for different groups. 

# To do so, we use the by function. 
# The by function take the following form
# 
# by( VARIABLE_YOU_WANT_TO_ANALYZE, GROUP, FUNCTION )
# 
# That is, you provide 
# (1) an interval-level variable you want to summarize first, 
# (2) a comma
# (3) a nominal variable that separates observations into groups
# (4) a comma
# (5) a function you want to apply (such as summary, mean, median, sd, etc.)

# For example, to obtain numerical summaries of gini04 for different regions, 
# we write

by(world.data $ gini04, world.data $ region, summary)


# Calculate the standard deviation of gini04 for different regions using
# the by function
# Hint: we still need to take care of the missing value problem. 
#       Use the na.rm = TRUE option. 

```{r}
by(world.data $ gini04, world.data $ region, sd, na.rm = TRUE)
```

# Which region has the smallest dispersion? 

```{r}
inequality_dispersion <- by(world.data$gini04, world.data$region, sd, na.rm = TRUE)
sd_results <- unlist(inequality_dispersion)
min_index <- which.min(sd_results)
min_sd_region <- names(inequality_dispersion)[min_index]
cat("Region with Minimum Standard Deviation:", min_sd_region, "\n")
#Scandinavia is the region with the smallest dispersion
```

# End of file
